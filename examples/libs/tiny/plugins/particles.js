!function(){var t={2158:function(){Tiny.Emitter=function(t){Tiny.Object2D.call(this),this.anchor=new Tiny.Point,this.maxParticles=t,this.particles=[],this.pattern=Tiny.Particle,this.fillStyle="#f54545",this.particleAnchor=new Tiny.Point(.5,.5),this.on=!1,this._timer=0,this._quantity=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this.blendMode="source-over"},Tiny.Emitter.prototype=Object.create(Tiny.Object2D.prototype),Tiny.Emitter.prototype.constructor=Tiny.Emitter,Object.defineProperty(Tiny.Emitter.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(Tiny.Emitter.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),Tiny.Emitter.prototype.makeParticles=function(t,i){var e;void 0===i&&(i=this.maxParticles);var r=this.particles.length;for(i>this.maxParticles&&(this.maxParticles=i);r<i;)e=new this.pattern(this),t&&e.setTexture(t),e.visible=!1,e.anchor.set(this.particleAnchor.x,this.particleAnchor.y),this.particles.push(e),r++},Tiny.Emitter.prototype.flow=function(t,i,e,r,s){return void 0!==e&&0!==e||(e=1),void 0===r&&(r=-1),void 0===s&&(s=!0),e>this.maxParticles&&(e=this.maxParticles),this._counter=0,this._flowQuantity=e,this._flowTotal=r,s?(this.start(!0,t,i,e),this._counter+=e,this.on=!0,this._timer=i):this.start(!1,t,i,e),this},Tiny.Emitter.prototype.explode=function(t,i){return this._flowTotal=0,void 0===i&&(i=this.particles.length),this.start(!0,t,0,i,!1),this},Tiny.Emitter.prototype.start=function(t,i,e,r){if(void 0===t&&(t=!0),void 0===i&&(i=0),null==e&&(e=250),void 0===r&&(r=0),r>this.maxParticles&&(r=this.maxParticles),this.visible=!0,this.lifespan=i,this.frequency=e,t)for(var s=0;s<r;s++)this.emitParticle();else this.on=!0,this._quantity=r,this._counter=0,this._timer=e;return this},Tiny.Emitter.prototype.emitParticle=function(t,i){void 0===t&&(t=null),void 0===i&&(i=null);for(var e,r=null,s=this.particles.length;s--;)if(!this.particles[s].visible){r=this.particles[s];break}if(null===r)return!1;var n=0,o=0;return null!==t?n=t:this._width>1&&(e=this._width/2,n=Tiny.rnd(-e,e)),null!==i?o=i:this._height>1&&(e=this._height/2,o=Tiny.rnd(-e,e)),r.reset(n,o),r.rotation=0,r.lifespan=this.lifespan,r.onEmit(),r.visible=!0,!0},Tiny.Emitter.prototype.destroy=function(){this.system&&this.system.remove(this),Tiny.Object2D.prototype.destroy.call(this)},Tiny.Emitter.prototype.update=function(t){if(!1!==this.visible){if(this.on&&(this._timer-=t,this._timer<=0))if(this._timer=this.frequency,0!==this._flowTotal)if(this._flowQuantity>0){for(var i=0;i<this._flowQuantity;i++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1));for(i=this.particles.length;i--;)this.particles[i]._update(t)}},Tiny.Emitter.prototype.render=function(t){if(!1!==this.visible&&0!==this.alpha)if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=t.currentBlendMode),this._cacheAsBitmap)this._renderCachedSprite(t);else{this._mask&&t.maskManager.pushMask(this._mask,t),t.context.fillStyle=this.fillStyle,t.context.globalAlpha=this.worldAlpha,t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution);var i=0;for(i=0;i<this.particles.length;i++)this.particles[i].render(t);for(i=0;i<this.children.length;i++)this.children[i].render(t);this._mask&&t.maskManager.popMask(t)}}},5856:function(){Tiny.Particle=function(t){Tiny.BaseObject2D.call(this),this.parent=t,this.anchor=new Tiny.Point,this.texture={valid:!1},this._frame=0,this.lifespan=0},Tiny.Particle.prototype=Object.create(Tiny.BaseObject2D.prototype),Tiny.Particle.prototype.constructor=Tiny.Particle,Tiny.Particle.prototype.setTexture=function(t,i){if("string"==typeof t){var e=t;null!=i&&(e=e+"_"+i),(t=Tiny.Cache.texture[e])||(t=new Tiny.Texture(e))}this.texture=t},Object.defineProperty(Tiny.Particle.prototype,"frameName",{get:function(){return this.texture.frame.name},set:function(t){this.texture.frame.name&&this.setTexture(Tiny.TextureCache[this.texture.key+"_"+t])}}),Object.defineProperty(Tiny.Particle.prototype,"frame",{get:function(){return this._frame},set:function(t){this.texture.max_no_frame&&(this._frame=t,this._frame>this.texture.max_no_frame&&(this._frame=0),this.setTexture(Tiny.TextureCache[this.texture.key+"_"+this._frame]))}}),Tiny.Particle.prototype.drawTexture=function(t){var i=this.anchor.x*-this.texture.frame.width,e=this.anchor.y*-this.texture.frame.height,r=this.texture.resolution/t.resolution;t.context.drawImage(this.texture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,i/r,e/r,this.texture.crop.width/r,this.texture.crop.height/r)},Tiny.Particle.prototype.reset=function(t,i){this.x=t||0,this.y=i||0,this.alpha=1,this.scale.set(1)},Tiny.Particle.prototype.update=function(t,i){},Tiny.Particle.prototype.onEmit=function(){},Tiny.Particle.prototype.draw=function(t){},Tiny.Particle.prototype._update=function(t){return!1!==this.visible&&(this.lifespan-=t,this.lifespan<=0?(this.visible=!1,!1):void this.update(this.lifespan,t))},Tiny.Particle.prototype.render=function(t){!1!==this.visible&&0!==this.alpha&&(this.updateTransform(),t.context.globalAlpha=this.worldAlpha,t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),this.texture.valid?this.drawTexture(t):this.draw(t.context,t.resolution))}}},i={};function e(r){var s=i[r];if(void 0!==s)return s.exports;var n=i[r]={exports:{}};return t[r](n,n.exports,e),n.exports}Tiny.Particles=function(t){this.game=t,this.list=[]},Tiny.Particles.prototype={add:function(t){return t.system=this,this.list.push(t),t},remove:function(t){var i=this.list.indexOf(t);if(i>-1)return(t=this.list.splice(i,1)).system=null,t},update:function(t){for(var i=this.list.length;i--;)this.list[i].update(t)},destroy:function(){this.list.length=0}},Tiny.Particles.prototype.constructor=Tiny.Particles,e(5856),e(2158),Tiny.registerSystem("particles",Tiny.Particles)}();